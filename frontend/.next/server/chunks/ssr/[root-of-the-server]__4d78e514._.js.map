{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///Users/based/Documents/projects/websocket/message/frontend/src/app/requests/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState, FormEvent } from \"react\";\nimport axios from \"axios\";\nimport { useRouter } from \"next/navigation\";\nimport { Check, X, Home } from \"lucide-react\";\nimport toast from 'react-hot-toast';\n\ntype Friends = {\n  friend: string;\n};\n\naxios.defaults.withCredentials = true\n\nexport default function Requests() {\n  const router = useRouter();\n  const [username, setUsername] = useState<string>('');\n  const [friends, setFriends] = useState<Friends[]>([]);\n  const [token, setToken] = useState<string>(\"\");\n\n  useEffect(() => {\n    const fetchUsername = async () => {\n      try {\n        const res = await axios.get('http://127.0.0.1:8081/me', {withCredentials: true});\n        console.log(res);\n        if (res.status === 200) {\n          setUsername(res.data);\n        } else {\n          console.log(\"can't find username\");\n          router.replace('/auth');\n        }\n      } catch (err) {\n        console.log(err);\n      }\n    }\n    fetchUsername();\n  }, []);\n\n  useEffect(() => {\n    const fetchFriendReq = async () => {\n      const response = await axios.get(\"http://127.0.0.1:8081/friend\");\n      console.log(response);\n      if (response.status === 200) {\n        setFriends(response.data);\n      }\n    };\n    fetchFriendReq();\n  }, []);\n\n  const friendResponse = async (e: FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    const action = (e.nativeEvent as SubmitEvent)\n      .submitter as HTMLButtonElement;\n\n    // collect the form fields\n    const form = e.currentTarget;\n    const data = new FormData(form);\n    data.set(\"action\", action.value);\n\n    const response = await axios.post(\n      \"http://127.0.0.1:8081/friend/respond\",\n      data,\n      {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${token}`,\n        },\n      }\n    );\n    if (response.status === 200) {\n      setFriends((prev) => prev.filter(f => f.friend !== data.get('friendId')));\n    }\n  };\n\n  const handleBack = () => {\n    void router.push('/ws');\n  }\n\n  return (\n    <div>\n      <div className=\"flex w-60 m-4 gap-2\">\n        <Home \n          className=\"cursor-pointer\"\n          onClick={handleBack}\n        />\n        <h2>Friend Requests</h2>\n      </div>\n      <div className=\"bg-gray-700 p-2 m-2 w-64 rounded\">\n        {\" \"}\n        {/* smaller box */}\n        <ul className=\"space-y-1\">\n          {\" \"}\n          {/* tiny gap between rows */}\n          {friends.length === 0 ? (\n            <p>No pending friend requests</p>\n          ) : (\n            friends.map((f, i) => (\n              <li key={i} className=\"flex items-center m-2\">\n                <span className=\"truncate\">{f.friend}</span>\n                  <form \n                    onSubmit={friendResponse} \n                    className=\"ml-auto flex gap-3\"\n                  >\n                    <input type=\"hidden\" name=\"friendId\" value={f.friend} />\n                    <button value=\"accepted\">\n                      <Check className=\"bg-green-400 cursor-pointer\" />\n                    </button>\n                    <button value=\"rejected\">\n                      <X className=\"bg-red-400 cursor-pointer\" />\n                    </button>\n                  </form>\n              </li>\n            ))\n          )}\n        </ul>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}