{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/based/Documents/projects/websocket/message/frontend/src/app/requests/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState, FormEvent } from \"react\";\nimport axios from \"axios\";\nimport { useRouter } from \"next/navigation\";\nimport { Check, X, Home } from \"lucide-react\";\nimport toast from 'react-hot-toast';\n\ntype Friends = {\n  friend: string;\n};\n\naxios.defaults.withCredentials = true\n\nexport default function Requests() {\n  const router = useRouter();\n  const [username, setUsername] = useState<string>('');\n  const [friends, setFriends] = useState<Friends[]>([]);\n  const [token, setToken] = useState<string>(\"\");\n\n  useEffect(() => {\n    const fetchUsername = async () => {\n      try {\n        const res = await axios.get('http://127.0.0.1:8081/me', {withCredentials: true});\n        console.log(res);\n        if (res.status === 200) {\n          setUsername(res.data);\n        } else {\n          console.log(\"can't find username\");\n          router.replace('/auth');\n        }\n      } catch (err) {\n        console.log(err);\n      }\n    }\n    fetchUsername();\n  }, []);\n\n  useEffect(() => {\n    const fetchFriendReq = async () => {\n      const response = await axios.get(\"http://127.0.0.1:8081/friend\");\n      console.log(response);\n      if (response.status === 200) {\n        setFriends(response.data);\n      }\n    };\n    fetchFriendReq();\n  }, []);\n\n  const friendResponse = async (e: FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    const action = (e.nativeEvent as SubmitEvent)\n      .submitter as HTMLButtonElement;\n\n    // collect the form fields\n    const form = e.currentTarget;\n    const data = new FormData(form);\n    data.set(\"action\", action.value);\n\n    const response = await axios.post(\n      \"http://127.0.0.1:8081/friend/respond\",\n      data,\n      {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${token}`,\n        },\n      }\n    );\n    if (response.status === 200) {\n      setFriends((prev) => prev.filter(f => f.friend !== data.get('friendId')));\n    }\n  };\n\n  const handleBack = () => {\n    void router.push('/ws');\n  }\n\n  return (\n    <div>\n      <div className=\"flex w-60 m-4 gap-2\">\n        <Home \n          className=\"cursor-pointer\"\n          onClick={handleBack}\n        />\n        <h2>Friend Requests</h2>\n      </div>\n      <div className=\"bg-gray-700 p-2 m-2 w-64 rounded\">\n        {\" \"}\n        {/* smaller box */}\n        <ul className=\"space-y-1\">\n          {\" \"}\n          {/* tiny gap between rows */}\n          {friends.length === 0 ? (\n            <p>No pending friend requests</p>\n          ) : (\n            friends.map((f, i) => (\n              <li key={i} className=\"flex items-center m-2\">\n                <span className=\"truncate\">{f.friend}</span>\n                  <form \n                    onSubmit={friendResponse} \n                    className=\"ml-auto flex gap-3\"\n                  >\n                    <input type=\"hidden\" name=\"friendId\" value={f.friend} />\n                    <button value=\"accepted\">\n                      <Check className=\"bg-green-400 cursor-pointer\" />\n                    </button>\n                    <button value=\"rejected\">\n                      <X className=\"bg-red-400 cursor-pointer\" />\n                    </button>\n                  </form>\n              </li>\n            ))\n          )}\n        </ul>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}