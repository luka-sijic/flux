{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/based/Documents/projects/websocket/message/frontend/src/app/ws/page.tsx"],"sourcesContent":["\"use client\";\nimport axios from \"axios\";\nimport { useState, useEffect, useRef } from \"react\";\nimport { Circle, Plus } from \"lucide-react\";\n\ntype WSMessage = {\n  type: \"join\" | \"chat\" | \"users\" | \"log\" | \"ping\";\n  user?: string;\n  content?: string;\n  users?: Record<string, string>;\n  log?: string[];\n};\n\nexport default function Home() {\n  const connection = useRef<WebSocket | null>(null);\n  const [username, setUsername] = useState<string>(\"\");\n  const [inputValue, setInputValue] = useState<string>(\"\");\n  const [friendValue, setFriendValue] = useState<string>(\"\");\n  const [messages, setMessages] = useState<WSMessage[]>([]);\n  const [addFriend, setAddFriend] = useState<Boolean>(false);\n  const [log, setLog] = useState<string[]>([]);\n  const [users, setUsers] = useState<Record<string, string>>({});\n\n  useEffect(() => {\n    const socket = new WebSocket(\"ws://127.0.0.1:8080/ws\");\n\n    socket.onopen = () => {\n      console.log(\"Connection opened\");\n    };\n\n    socket.onmessage = (event) => {\n      const data = JSON.parse(event.data) as WSMessage;\n\n      switch (data.type) {\n        case \"log\":\n          console.log(data);\n          const byteLen = new TextEncoder().encode(JSON.stringify(data)).length;\n          console.log(\"Length: \" + byteLen);\n          setLog(data.log ?? []);\n        case \"users\":\n          // data.users is string[] or undefined → default to []\n          setUsers(data.users ?? {});\n          break;\n\n        case \"chat\":\n          // append the new WSMessage to our array\n          setMessages((prev) => [...prev, data]);\n          break;\n        case \"ping\":\n          socket.send(JSON.stringify({ type: \"pong\" }));\n          break;\n      }\n    };\n\n    connection.current = socket;\n    return () => {\n      socket.close();\n    };\n  }, []);\n\n  const addNewFriend = async (e: React.FormEvent) => {\n    e.preventDefault();\n    const friend = friendValue;\n    const res = await axios.post('http://127.0.0.1:8082/friend', friend);\n    if (res.data.response) {\n      console.log(\"friend addded\");\n    } else {\n      console.log(\"friend failed to add\");\n    }\n  }\n\n  const handleFriend = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setAddFriend(!addFriend);\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (\n      !connection.current ||\n      connection.current.readyState !== WebSocket.OPEN\n    ) {\n      console.error(\"WebSocket not open\");\n      return;\n    }\n\n    // First submit uses inputValue as the username\n    if (!username) {\n      const name = inputValue.trim();\n      if (!name) return;\n      connection.current.send(JSON.stringify({ type: \"join\", user: name }));\n      setUsername(name);\n      setInputValue(\"\");\n      return;\n    }\n\n    // Afterwards, send chat messages\n    const content = inputValue.trim();\n    if (content.length) if (!content) return;\n    connection.current.send(\n      JSON.stringify({ type: \"chat\", user: username, content })\n    );\n    setInputValue(\"\");\n  };\n\n  return (\n    <div className=\"flex h-screen overflow-x-hidden\">\n      <div className=\"w-64 border border-white rounded p-4 bg-black text-white\">\n        <div className=\"flex justify-between\">\n          <h2 className=\"text-xl font-semibold mb-2\">Users</h2>\n          <form onSubmit={handleFriend}>\n            <button type=\"submit\">\n              <Plus />\n            </button>\n          </form>\n        </div>\n        {addFriend ? (\n          <form onSubmit={addNewFriend}>\n          <input \n            value={friendValue}\n            onChange={(e) => setFriendValue(e.target.value)}\n            placeholder=\"add friend...\"\n            className=\"bg-gray-800 rounded p-1\"\n          />\n          </form>\n        ) : (\n        ''\n        )}\n        {/* 1) Users column */}\n        <ul>\n          {Object.keys(users).length === 0 ? (\n            <p className=\"text-gray-500 py-2\">No users connected</p>\n          ) : (\n            Object.entries(users).map(([key, value]) => (\n              <li key={key} className=\"flex items-center gap-1\">\n                <Circle\n                  size={12}\n                  stroke=\"none\"\n                  fill=\"currentColor\"\n                  className={\n                    value === \"active\" ? \"text-green-500\" : \"text-red-500\"\n                  }\n                />\n                <span>{key}</span>\n              </li>\n            ))\n          )}\n        </ul>\n      </div>\n      {/* Chat Column */}\n      <div className=\"flex flex-col flex-1 p-4 min-h-0\">\n        {/* Messages: now fills full height and only scrolls vertically */}\n        <div\n          className=\"\n        flex-1                /* take up all remaining vertical space */\n        overflow-y-auto       /* vertical scrolling as needed */\n        overflow-x-hidden     /* hide any horizontal overflow */\n        border rounded p-3\n        whitespace-pre-wrap\n        break-words           /* wrap long words */\n        break-all             /* break really long tokens if needed */\n        bg-black text-white\n      \"\n        >\n          {log.map((m, i) => (\n            <p key={i}>{m}</p>\n          ))}\n          {messages.map((m, i) => (\n            <p key={i}>\n              <strong>{m.user}:</strong> {m.content}\n            </p>\n          ))}\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"flex mt-4 space-x-2\">\n          <input\n            type=\"text\"\n            value={inputValue}\n            onChange={(e) => setInputValue(e.target.value)}\n            placeholder={username ? \"Send a message…\" : \"Set your username…\"}\n            minLength={2}\n            maxLength={200}\n            required\n            className=\"flex-1 border rounded px-3 py-2 focus:outline-none focus:ring\"\n          />\n          <button\n            type=\"submit\"\n            className=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition\"\n          >\n            {username ? \"Send\" : \"Join\"}\n          </button>\n        </form>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AAAA;;;AAHA;;;;AAae,SAAS;;IACtB,MAAM,aAAa,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAoB;IAC5C,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAU;IACjD,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAU;IACrD,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAU;IACvD,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAe,EAAE;IACxD,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAW;IACpD,MAAM,CAAC,KAAK,OAAO,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAY,EAAE;IAC3C,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAA0B,CAAC;IAE5D,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;0BAAE;YACR,MAAM,SAAS,IAAI,UAAU;YAE7B,OAAO,MAAM;kCAAG;oBACd,QAAQ,GAAG,CAAC;gBACd;;YAEA,OAAO,SAAS;kCAAG,CAAC;oBAClB,MAAM,OAAO,KAAK,KAAK,CAAC,MAAM,IAAI;oBAElC,OAAQ,KAAK,IAAI;wBACf,KAAK;4BACH,QAAQ,GAAG,CAAC;4BACZ,MAAM,UAAU,IAAI,cAAc,MAAM,CAAC,KAAK,SAAS,CAAC,OAAO,MAAM;4BACrE,QAAQ,GAAG,CAAC,aAAa;gCAClB;4BAAP,OAAO,CAAA,YAAA,KAAK,GAAG,cAAR,uBAAA,YAAY,EAAE;wBACvB,KAAK;gCAEM;4BADT,sDAAsD;4BACtD,SAAS,CAAA,cAAA,KAAK,KAAK,cAAV,yBAAA,cAAc,CAAC;4BACxB;wBAEF,KAAK;4BACH,wCAAwC;4BACxC;kDAAY,CAAC,OAAS;2CAAI;wCAAM;qCAAK;;4BACrC;wBACF,KAAK;4BACH,OAAO,IAAI,CAAC,KAAK,SAAS,CAAC;gCAAE,MAAM;4BAAO;4BAC1C;oBACJ;gBACF;;YAEA,WAAW,OAAO,GAAG;YACrB;kCAAO;oBACL,OAAO,KAAK;gBACd;;QACF;yBAAG,EAAE;IAEL,MAAM,eAAe,OAAO;QAC1B,EAAE,cAAc;QAChB,MAAM,SAAS;QACf,MAAM,MAAM,MAAM,wIAAA,CAAA,UAAK,CAAC,IAAI,CAAC,gCAAgC;QAC7D,IAAI,IAAI,IAAI,CAAC,QAAQ,EAAE;YACrB,QAAQ,GAAG,CAAC;QACd,OAAO;YACL,QAAQ,GAAG,CAAC;QACd;IACF;IAEA,MAAM,eAAe,OAAO;QAC1B,EAAE,cAAc;QAChB,aAAa,CAAC;IAChB;IAEA,MAAM,eAAe,OAAO;QAC1B,EAAE,cAAc;QAChB,IACE,CAAC,WAAW,OAAO,IACnB,WAAW,OAAO,CAAC,UAAU,KAAK,UAAU,IAAI,EAChD;YACA,QAAQ,KAAK,CAAC;YACd;QACF;QAEA,+CAA+C;QAC/C,IAAI,CAAC,UAAU;YACb,MAAM,OAAO,WAAW,IAAI;YAC5B,IAAI,CAAC,MAAM;YACX,WAAW,OAAO,CAAC,IAAI,CAAC,KAAK,SAAS,CAAC;gBAAE,MAAM;gBAAQ,MAAM;YAAK;YAClE,YAAY;YACZ,cAAc;YACd;QACF;QAEA,iCAAiC;QACjC,MAAM,UAAU,WAAW,IAAI;QAC/B,IAAI,QAAQ,MAAM,EAAE;YAAA,IAAI,CAAC,SAAS;QAAM;QACxC,WAAW,OAAO,CAAC,IAAI,CACrB,KAAK,SAAS,CAAC;YAAE,MAAM;YAAQ,MAAM;YAAU;QAAQ;QAEzD,cAAc;IAChB;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAG,WAAU;0CAA6B;;;;;;0CAC3C,6LAAC;gCAAK,UAAU;0CACd,cAAA,6LAAC;oCAAO,MAAK;8CACX,cAAA,6LAAC,qMAAA,CAAA,OAAI;;;;;;;;;;;;;;;;;;;;;oBAIV,0BACC,6LAAC;wBAAK,UAAU;kCAChB,cAAA,6LAAC;4BACC,OAAO;4BACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;4BAC9C,aAAY;4BACZ,WAAU;;;;;;;;;;+BAId;kCAGA,6LAAC;kCACE,OAAO,IAAI,CAAC,OAAO,MAAM,KAAK,kBAC7B,6LAAC;4BAAE,WAAU;sCAAqB;;;;;mCAElC,OAAO,OAAO,CAAC,OAAO,GAAG,CAAC;gCAAC,CAAC,KAAK,MAAM;iDACrC,6LAAC;gCAAa,WAAU;;kDACtB,6LAAC,yMAAA,CAAA,SAAM;wCACL,MAAM;wCACN,QAAO;wCACP,MAAK;wCACL,WACE,UAAU,WAAW,mBAAmB;;;;;;kDAG5C,6LAAC;kDAAM;;;;;;;+BATA;;;;;;;;;;;;;;;;;0BAgBjB,6LAAC;gBAAI,WAAU;;kCAEb,6LAAC;wBACC,WAAU;;4BAWT,IAAI,GAAG,CAAC,CAAC,GAAG,kBACX,6LAAC;8CAAW;mCAAJ;;;;;4BAET,SAAS,GAAG,CAAC,CAAC,GAAG,kBAChB,6LAAC;;sDACC,6LAAC;;gDAAQ,EAAE,IAAI;gDAAC;;;;;;;wCAAU;wCAAE,EAAE,OAAO;;mCAD/B;;;;;;;;;;;kCAMZ,6LAAC;wBAAK,UAAU;wBAAc,WAAU;;0CACtC,6LAAC;gCACC,MAAK;gCACL,OAAO;gCACP,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,KAAK;gCAC7C,aAAa,WAAW,oBAAoB;gCAC5C,WAAW;gCACX,WAAW;gCACX,QAAQ;gCACR,WAAU;;;;;;0CAEZ,6LAAC;gCACC,MAAK;gCACL,WAAU;0CAET,WAAW,SAAS;;;;;;;;;;;;;;;;;;;;;;;;AAMjC;GAtLwB;KAAA","debugId":null}}]
}